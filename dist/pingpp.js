!function(e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).pingpp=e()}(function(){return function t(r,i,l){function c(n,e){if(!i[n]){if(!r[n]){var a="function"==typeof require&&require;if(!e&&a)return a(n,!0);if(o)return o(n,!0);throw(a=new Error("Cannot find module '"+n+"'")).code="MODULE_NOT_FOUND",a}a=i[n]={exports:{}},r[n][0].call(a.exports,function(e){return c(r[n][1][e]||e)},a,a.exports,t,r,i,l)}return i[n].exports}for(var o="function"==typeof require&&require,e=0;e<l.length;e++)c(l[e]);return c}({1:[function(e,n,a){var r={}.hasOwnProperty,i=e('./callbacks'),l=e('./utils');n.exports={signAgreement:function(e){var n;if('string'==typeof e)try{n=JSON.parse(e)}catch(e){return i.innerAgreementCallback('fail',i.error('json_decode_fail',e)),!1}else n=e;if(void 0===n)return i.innerAgreementCallback('fail',i.error('json_decode_fail')),!1;if(!r.call(n,'object')||'agreement'!==n.object||!r.call(n,'channel')||!r.call(n,'credential')||'object'!=typeof n.credential)return i.innerAgreementCallback('fail',i.error('invalid_object')),!1;if(!r.call(n.credential,n.channel))return i.innerAgreementCallback('fail',i.error('invalid_credential')),!1;var a,t=n.credential[n.channel];return'string'==typeof t?a=t:r.call(t,'credential')&&'string'==typeof t.credential&&(a=t.credential),void 0===a?(i.innerAgreementCallback('fail',i.error('invalid_credential')),!1):('alipay'===n.channel.substring(0,6)&&(t=new URL(a),a='http://d.alipay.com/i/index.htm?iframeSrc='+encodeURIComponent("alipays://platformapi/startapp?appId=60000157&appClearTop=false&startMultApp=YES&sign_params="+encodeURIComponent(t.search.substring(1)))),setTimeout(function(){l.redirectTo(a)},0),!0)}}},{"./callbacks":2,"./utils":47}],2:[function(a,e,n){e.exports={userCallback:void 0,urlReturnCallback:void 0,urlReturnChannels:['alipay_pc_direct'],userAgreementCallback:void 0,innerCallback:function(e,n){'function'==typeof this.userCallback&&(void 0===n&&(n=this.error()),this.userCallback(e,n),this.userCallback=void 0,a('./payment_elements').clear())},error:function(e,n){return{msg:e=void 0===e?'':e,extra:n=void 0===n?'':n}},triggerUrlReturnCallback:function(e,n){'function'==typeof this.urlReturnCallback&&this.urlReturnCallback(e,n)},shouldReturnUrlByCallback:function(e){return'function'==typeof this.urlReturnCallback&&-1!==this.urlReturnChannels.indexOf(e)},innerAgreementCallback:function(e,n){'function'==typeof this.userAgreementCallback&&(void 0===n&&(n=this.error()),this.userAgreementCallback(e,n),this.userAgreementCallback=void 0)}}},{"./payment_elements":44}],3:[function(e,n,a){var t=e('../callbacks'),r={}.hasOwnProperty;n.exports={PINGPP_NOTIFY_URL_BASE:'https://notify.pingxx.com/notify',handleCharge:function(e){e=e.credential[e.channel];e||r.call(e,'orderInfo')?this.callpay(e.orderInfo):t.innerCallback('fail',t.error('invalid_credential','missing_alipay'))},alipayLiteEnabled:function(){return'undefined'!=typeof my&&my.tradePay},callpay:function(e){var n=this;if(this.alipayLiteEnabled())return this.alipayLitePay(e);if('undefined'!=typeof navigator&&/AlipayClient/.test(navigator.userAgent||navigator.swuserAgent))return this.waitAlipayJSBridgde(function(){n.alipayJsBridgePay(e)});var a='请在支付宝小程序或者支付宝应用内中打开';console.log(a),t.innerCallback('fail',t.error(a))},waitAlipayJSBridgde:function(e){window.AlipayJSBridge?e&&e():document.addEventListener('AlipayJSBridgeReady',e,!1)},alipayJsBridgePay:function(e){AlipayJSBridge.call('tradePay',{orderStr:e},this.alipayResultHandler)},alipayLitePay:function(e){var n={};n.orderStr=e,n.complete=this.alipayResultHandler,my.tradePay(n)},alipayResultHandler:function(e){var n={resultCode:e.resultCode};r.call(e,'memo')&&(n.memo=e.memo),r.call(e,'result')&&(n.result=e.result),'9000'==e.resultCode?t.innerCallback('success',t.error('',n)):'6001'==e.resultCode?t.innerCallback('cancel',t.error('用户取消支付',n)):t.innerCallback('fail',t.error('支付失败',n))},runTestMode:function(e){e='/charges/'+e.id;my.httpRequest({url:this.PINGPP_NOTIFY_URL_BASE+e+'?livemode=false',success:function(e){'success'==e.data?t.innerCallback('success'):t.innerCallback('fail',t.error('testmode_notify_fail'))},fail:function(){t.innerCallback('fail',t.error('network_err'))}})}}},{"../callbacks":2}],4:[function(e,n,a){var t=e('../callbacks');n.exports={PINGPP_NOTIFY_URL_BASE:'https://notify.pingxx.com/notify',handleCharge:function(e){e=e.credential[e.channel];e?this.callpay(e):t.innerCallback('fail',t.error('invalid_credential','missing_alipay_lite'))},alipayLiteEnabled:function(){return'undefined'!=typeof my&&my.tradePay},callpay:function(e){var n;this.alipayLiteEnabled()?((n={}).tradeNO=e,n.complete=function(e){9e3==e.resultCode?t.innerCallback('success'):6001==e.resultCode?t.innerCallback('cancel',t.error('用户取消支付')):t.innerCallback('fail',t.error('支付失败'))},my.tradePay(n)):console.log('请在支付宝小程序中打开')},runTestMode:function(e){e='/charges/'+e.id;my.httpRequest({url:this.PINGPP_NOTIFY_URL_BASE+e+'?livemode=false',success:function(e){'success'==e.data?t.innerCallback('success'):t.innerCallback('fail',t.error('testmode_notify_fail'))},fail:function(){t.innerCallback('fail',t.error('network_err'))}})}}},{"../callbacks":2}],5:[function(e,n,a){var t=e('../utils'),r={}.hasOwnProperty;n.exports={ALIPAY_PC_DIRECT_URL:'https://mapi.alipay.com/gateway.do',handleCharge:function(e){var n=e.channel,a=e.credential[n],e=this.ALIPAY_PC_DIRECT_URL;r.call(a,'channel_url')&&(e=a.channel_url),r.call(a,'_input_charset')||r.call(a,'service')&&'create_direct_pay_by_user'===a.service&&(a._input_charset='utf-8');a=t.stringifyData(a,n,!0);t.redirectTo(e+'?'+a,n)}}},{"../utils":47}],6:[function(e,n,a){var t={}.hasOwnProperty,r=e('../callbacks');n.exports={handleCharge:function(e){e=e.credential[e.channel];t.call(e,'transaction_no')?this.tradePay(e.transaction_no):r.innerCallback('fail',r.error('invalid_credential','missing_field_transaction_no'))},ready:function(e){window.AlipayJSBridge?e&&e():document.addEventListener('AlipayJSBridgeReady',e,!1)},tradePay:function(e){this.ready(function(){AlipayJSBridge.call('tradePay',{tradeNO:e},function(e){'9000'==e.resultCode?r.innerCallback('success'):'6001'==e.resultCode?r.innerCallback('cancel',r.error(e.result)):r.innerCallback('fail',r.error(e.result))})})}}},{"../callbacks":2}],7:[function(e,n,a){var t=e('./commons/redirect_base');n.exports={handleCharge:function(e){t.handleCharge(e)}}},{"./commons/redirect_base":18}],8:[function(e,n,a){var t=e('../utils'),r=e('../mods'),i={}.hasOwnProperty;n.exports={ALIPAY_WAP_URL_OLD:'https://wappaygw.alipay.com/service/rest.htm',ALIPAY_WAP_URL:'https://mapi.alipay.com/gateway.do',handleCharge:function(e){var n=e.channel,a=e.credential[n],e=this.ALIPAY_WAP_URL;i.call(a,'req_data')?e=this.ALIPAY_WAP_URL_OLD:i.call(a,'channel_url')&&(e=a.channel_url),i.call(a,'_input_charset')||(i.call(a,'service')&&'alipay.wap.create.direct.pay.by.user'===a.service||i.call(a,'req_data'))&&(a._input_charset='utf-8');e=e+'?'+t.stringifyData(a,n,!0),a=r.getExtraModule('ap');t.inWeixin()&&void 0!==a?a.pay(e):t.redirectTo(e,n)}}},{"../mods":43,"../utils":47}],9:[function(e,n,a){arguments[4][7][0].apply(a,arguments)},{"./commons/redirect_base":18,dup:7}],10:[function(e,n,a){var t=e('../utils'),r=e('../callbacks'),i={}.hasOwnProperty;n.exports={handleCharge:function(e){var n=e.channel,e=e.credential[n];i.call(e,'url')?t.redirectTo(e.url+'?'+t.stringifyData(e,n),n):r.innerCallback('fail',r.error('invalid_credential','missing_field:url'))}}},{"../callbacks":2,"../utils":47}],11:[function(e,n,a){var t=e('../utils'),r={}.hasOwnProperty;n.exports={ALIPAY_PC_DIRECT_URL:'https://intlmapi.alipay.com/gateway.do',handleCharge:function(e){var n=e.channel,a=e.credential[n],e=this.ALIPAY_PC_DIRECT_URL;r.call(a,'channel_url')&&(e=a.channel_url),r.call(a,'_input_charset')||r.call(a,'service')&&'create_forex_trade'===a.service&&(a._input_charset='utf-8');a=t.stringifyData(a,n,!0);t.redirectTo(e+'?'+a,n)}}},{"../utils":47}],12:[function(e,n,a){var t=e('../utils'),r=e('../mods'),i={}.hasOwnProperty;n.exports={ALIPAY_WAP_URL:'https://intlmapi.alipay.com/gateway.do',handleCharge:function(e){var n=e.channel,a=e.credential[n],e=this.ALIPAY_WAP_URL;i.call(a,'channel_url')&&(e=a.channel_url),i.call(a,'_input_charset')||i.call(a,'service')&&'create_forex_trade_wap'===a.service&&(a._input_charset='utf-8');e=e+'?'+t.stringifyData(a,n,!0),a=r.getExtraModule('ap');t.inWeixin()&&void 0!==a?a.pay(e):t.redirectTo(e,n)}}},{"../mods":43,"../utils":47}],13:[function(e,n,a){var r=e('../callbacks'),t=e('../utils'),i=e('../stash'),l=e('../mods'),c={}.hasOwnProperty;n.exports={PINGPP_NOTIFY_URL_BASE:'https://notify.pingxx.com/notify',handleCharge:function(e){for(var n=e.credential[e.channel],a=['appId','timeStamp','nonceStr','package','signType','paySign'],t=0;t<a.length;t++)if(!c.call(n,a[t]))return void r.innerCallback('fail',r.error('invalid_credential','missing_field_'+a[t]));i.jsApiParameters=n,this.callpay()},callpay:function(){var e=this,n=l.getExtraModule('wx_jssdk');void 0!==n&&n.jssdkEnabled()?n.callpay():'undefined'==typeof WeixinJSBridge?(n=function(){e.jsApiCall()},document.addEventListener?document.addEventListener('WeixinJSBridgeReady',n,!1):document.attachEvent&&(document.attachEvent('WeixinJSBridgeReady',n),document.attachEvent('onWeixinJSBridgeReady',n))):this.jsApiCall()},jsApiCall:function(){c.call(i,'jsApiParameters')&&WeixinJSBridge.invoke('getBrandWCPayRequest',i.jsApiParameters,function(e){delete i.jsApiParameters,'get_brand_wcpay_request:ok'==e.err_msg?r.innerCallback('success'):'get_brand_wcpay_request:cancel'==e.err_msg?r.innerCallback('cancel'):r.innerCallback('fail',r.error('wx_result_fail',e.err_msg))})},runTestMode:function(e){confirm('模拟付款？')&&(e='/charges/'+e.id,t.request(this.PINGPP_NOTIFY_URL_BASE+e+'?livemode=false','GET',null,function(e,n){200<=n&&n<400&&'success'==e?r.innerCallback('success'):(e='http_code:'+n+';response:'+e,r.innerCallback('fail',r.error('testmode_notify_fail',e)))},function(){r.innerCallback('fail',r.error('network_err'))}))}}},{"../callbacks":2,"../mods":43,"../stash":45,"../utils":47}],14:[function(e,n,a){arguments[4][7][0].apply(a,arguments)},{"./commons/redirect_base":18,dup:7}],15:[function(e,n,a){var t=e('../utils'),r={}.hasOwnProperty,i=e('../callbacks');n.exports={CCB_WAP_URL_BASE:'https://ibsbjstar.ccb.com.cn/CCBIS/ccbMain?',handleCharge:function(e){var n=e.channel,e=e.credential[n];r.call(e,'orderinfo')?(e=this.CCB_WAP_URL_BASE+e.orderinfo,t.redirectTo(e,n)):i.innerCallback('fail',i.error('invalid_credential','missing_field:orderinfo'))}}},{"../callbacks":2,"../utils":47}],16:[function(e,n,a){var t=e('../utils'),r={}.hasOwnProperty;n.exports={handleCharge:function(e){var n,a=e.channel,a=e.credential[a];r.call(a,'channel_url')&&(n=a.channel_url,delete a.channel_url),t.formSubmit(n,'post',a)}}},{"../utils":47}],17:[function(e,n,a){var t=e('../utils'),r={}.hasOwnProperty;n.exports={CMB_WALLET_URL:'https://netpay.cmbchina.com/netpayment/BaseHttp.dll?MB_EUserPay',handleCharge:function(e){var n=e.credential[e.channel],e=this.CMB_WALLET_URL;r.call(n,'ChannelUrl')&&(e=n.ChannelUrl,delete n.ChannelUrl),r.call(n,'channelVersion')&&delete n.channelVersion,t.formSubmit(e,'post',n)}}},{"../utils":47}],18:[function(e,n,a){var t=e('../../utils'),r=e('../../callbacks'),i={}.hasOwnProperty;n.exports={handleCharge:function(e){var n,a=e.credential[e.channel];if('string'==typeof a)n=a;else{if(!i.call(a,'url'))return void r.innerCallback('fail',r.error('invalid_credential','credential format is incorrect'));n=a.url}t.redirectTo(n,e.channel)}}},{"../../callbacks":2,"../../utils":47}],19:[function(e,n,a){var t=e('../utils');n.exports={handleCharge:function(e){e=e.credential[e.channel];t.formSubmit(e.request_url,'post',e.request_data)}}},{"../utils":47}],20:[function(e,n,a){var t=e('../utils');n.exports={CP_B2B_URL:'https://payment.chinapay.com/CTITS/service/rest/page/nref/000000000017/0/0/0/0/0',handleCharge:function(e){e=e.credential[e.channel];t.formSubmit(this.CP_B2B_URL,'post',e)}}},{"../utils":47}],21:[function(e,n,a){var t,o,r=e('../../stash'),i={}.hasOwnProperty;o={PADCHAR:'=',ALPHA:'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/',makeDOMException:function(){try{return new DOMException(DOMException.INVALID_CHARACTER_ERR)}catch(e){var n=new Error('DOM Exception 5');return n.code=n.number=5,n.name=n.description='INVALID_CHARACTER_ERR',n.toString=function(){return'Error: '+n.name+': '+n.message},n}},getbyte64:function(e,n){n=o.ALPHA.indexOf(e.charAt(n));if(-1===n)throw o.makeDOMException();return n},decode:function(e){e=''+e;var n,a,t=o.getbyte64,r=e.length;if(0===r)return e;if(r%4!=0)throw o.makeDOMException();n=0,e.charAt(r-1)===o.PADCHAR&&(n=1,e.charAt(r-2)===o.PADCHAR&&(n=2),r-=4);for(var i=[],l=0;l<r;l+=4)a=t(e,l)<<18|t(e,l+1)<<12|t(e,l+2)<<6|t(e,l+3),i.push(String.fromCharCode(a>>16,a>>8&255,255&a));switch(n){case 1:a=t(e,l)<<18|t(e,l+1)<<12|t(e,l+2)<<6,i.push(String.fromCharCode(a>>16,a>>8&255));break;case 2:a=t(e,l)<<18|t(e,l+1)<<12,i.push(String.fromCharCode(a>>16))}return i.join('')},getbyte:function(e,n){n=e.charCodeAt(n);if(255<n)throw o.makeDOMException();return n},encode:function(e){if(1!==arguments.length)throw new SyntaxError('Not enough arguments');var n,a,t=o.PADCHAR,r=o.ALPHA,i=o.getbyte,l=[],c=(e=''+e).length-e.length%3;if(0===e.length)return e;for(n=0;n<c;n+=3)a=i(e,n)<<16|i(e,n+1)<<8|i(e,n+2),l.push(r.charAt(a>>18)),l.push(r.charAt(a>>12&63)),l.push(r.charAt(a>>6&63)),l.push(r.charAt(63&a));switch(e.length-c){case 1:a=i(e,n)<<16,l.push(r.charAt(a>>18)+r.charAt(a>>12&63)+t+t);break;case 2:a=i(e,n)<<16|i(e,n+1)<<8,l.push(r.charAt(a>>18)+r.charAt(a>>12&63)+r.charAt(a>>6&63)+t)}return l.join('')}},(t={}).url='pay.htm',t.pay=function(e){e=encodeURIComponent(o.encode(e));i.call(r,'APURL')&&(t.url=r.APURL),location.href=t.url+'?goto='+e},t.decode=function(e){return o.decode(decodeURIComponent(e))},n.exports=t},{"../../stash":45}],22:[function(e,n,a){e=e('./wx_lite');n.exports=e},{"./wx_lite":31}],23:[function(e,n,a){var t=e('./commons/redirect_base'),r=e('../callbacks'),i=e('../utils'),l={}.hasOwnProperty;n.exports={handleCharge:function(e){var n=e.extra;l.call(n,'pay_channel')?'wx'!==(n=n.pay_channel)||i.inWeixin()?'alipay'!==n||i.inAlipay()?t.handleCharge(e):r.innerCallback('fail',r.error('Not in the Alipay browser')):r.innerCallback('fail',r.error('Not in the WeChat browser')):r.innerCallback('fail',r.error('invalid_charge','charge 格式不正确'))}}},{"../callbacks":2,"../utils":47,"./commons/redirect_base":18}],24:[function(e,n,a){var t=e('../utils'),r={}.hasOwnProperty;n.exports={JDPAY_WAP_URL_OLD:'https://m.jdpay.com/wepay/web/pay',JDPAY_H5_URL:'https://h5pay.jd.com/jdpay/saveOrder',JDPAY_PC_URL:'https://wepay.jd.com/jdpay/saveOrder',handleCharge:function(e){var n=e.credential[e.channel],e=this.JDPAY_H5_URL;r.call(n,'channelUrl')?(e=n.channelUrl,delete n.channelUrl):r.call(n,'merchantRemark')&&(e=this.JDPAY_WAP_URL_OLD),t.formSubmit(e,'post',n)}}},{"../utils":47}],25:[function(e,n,a){var t=e('../utils');n.exports={handleCharge:function(e){var n=e.credential[e.channel],e=n.channelUrl;delete n.channelUrl,t.formSubmit(e,'post',n)}}},{"../utils":47}],26:[function(e,n,a){var t=e('../utils');n.exports={handleCharge:function(e){var n=e.credential[e.channel];t.redirectTo(n,e.channel)}}},{"../utils":47}],27:[function(e,n,a){var t=e('../callbacks'),r=e('../utils'),i=e('../stash'),l={}.hasOwnProperty;n.exports={SRC_URL:'https://open.mobile.qq.com/sdk/qqapi.js?_bid=152',ID:'mqq_api',handleCharge:function(e){e=e.credential[e.channel];l.call(e,'token_id')?(i.tokenId=e.token_id,r.loadUrlJs(this.ID,this.SRC_URL,this.callpay)):t.innerCallback('fail',t.error('invalid_credential','missing_token_id'))},callpay:function(){if('undefined'!=typeof mqq){if(0==mqq.QQVersion)return t.innerCallback('fail',t.error('Not in the QQ client')),void delete i.tokenId;mqq.tenpay.pay({tokenId:i.tokenId},function(e){0==e.resultCode?t.innerCallback('success'):t.innerCallback('fail',t.error(e.retmsg))})}else t.innerCallback('fail',t.error('network_err'));delete i.tokenId}}},{"../callbacks":2,"../stash":45,"../utils":47}],28:[function(e,n,a){arguments[4][16][0].apply(a,arguments)},{"../utils":47,dup:16}],29:[function(e,n,a){var t=e('../utils');n.exports={UPACP_PC_URL:'https://gateway.95516.com/gateway/api/frontTransReq.do',handleCharge:function(e){e=e.credential[e.channel];t.formSubmit(this.UPACP_PC_URL,'post',e)}}},{"../utils":47}],30:[function(e,n,a){var t=e('../utils');n.exports={UPACP_WAP_URL:'https://gateway.95516.com/gateway/api/frontTransReq.do',handleCharge:function(e){e=e.credential[e.channel];t.formSubmit(this.UPACP_WAP_URL,'post',e)}}},{"../utils":47}],31:[function(e,n,a){var r=e('../stash'),i=e('../callbacks'),l={}.hasOwnProperty;n.exports={PINGPP_NOTIFY_URL_BASE:'https://notify.pingxx.com/notify',handleCharge:function(e){for(var n=e.credential[e.channel],a=['appId','timeStamp','nonceStr','package','signType','paySign'],t=0;t<a.length;t++)if(!l.call(n,a[t]))return void i.innerCallback('fail',i.error('invalid_credential','missing_field_'+a[t]));r.jsApiParameters=n,this.callpay()},wxLiteEnabled:function(){return'undefined'!=typeof wx&&wx.requestPayment},callpay:function(){var e;this.wxLiteEnabled()?(delete(e=r.jsApiParameters).appId,e.complete=function(e){'requestPayment:ok'===e.errMsg&&i.innerCallback('success'),'requestPayment:cancel'!==e.errMsg&&'requestPayment:fail cancel'!==e.errMsg||i.innerCallback('cancel',i.error('用户取消支付')),'undefined'!==e.err_code&&'undefined'!==e.err_desc&&i.innerCallback('fail',i.error(e.err_desc,e))},wx.requestPayment(e)):console.log('请在微信小程序中打开')},runTestMode:function(e){e='/charges/'+e.id;wx.request({url:this.PINGPP_NOTIFY_URL_BASE+e+'?livemode=false',success:function(e){'success'==e.data?i.innerCallback('success'):i.innerCallback('fail',i.error('testmode_notify_fail'))},fail:function(){i.innerCallback('fail',i.error('network_err'))}})}}},{"../callbacks":2,"../stash":45}],32:[function(e,n,a){arguments[4][22][0].apply(a,arguments)},{"./wx_lite":31,dup:22}],33:[function(e,n,a){arguments[4][13][0].apply(a,arguments)},{"../callbacks":2,"../mods":43,"../stash":45,"../utils":47,dup:13}],34:[function(e,n,a){e=e('./wx_pub');n.exports=e},{"./wx_pub":33}],35:[function(e,n,a){arguments[4][34][0].apply(a,arguments)},{"./wx_pub":33,dup:34}],36:[function(e,n,a){var t=e('../utils'),r=e('../callbacks'),i={}.hasOwnProperty;n.exports={handleCharge:function(e){var n=e.credential[e.channel];'string'==typeof n?t.redirectTo(n,e.channel):'object'==typeof n&&i.call(n,'url')?t.redirectTo(n.url,e.channel):r.innerCallback('fail',r.error('invalid_credential','credential 格式不正确'))}}},{"../callbacks":2,"../utils":47}],37:[function(e,n,a){var l=e('../utils'),c=e('../callbacks'),o={}.hasOwnProperty;n.exports={YEEPAY_WAP_URL:'https://ok.yeepay.com/paymobile/api/pay/request',YEEPAY_WAP_TEST_URL:'http://mobiletest.yeepay.com/paymobile/api/pay/request',handleCharge:function(e){for(var n,a=e.channel,t=e.credential[a],r=['merchantaccount','encryptkey','data'],i=0;i<r.length;i++)if(!o.call(t,r[i]))return void c.innerCallback('fail',c.error('invalid_credential','missing_field_'+r[i]));n=o.call(t,'mode')&&'test'==t.mode?this.YEEPAY_WAP_TEST_URL:this.YEEPAY_WAP_URL,l.redirectTo(n+'?'+l.stringifyData(t,a,!0),e.channel)}}},{"../callbacks":2,"../utils":47}],38:[function(e,n,a){function i(e,n){return n=new RegExp('(^|&)'+n+'=([^&]*)(&|$)','i'),null!==(n=e.substring(0).match(n))?unescape(n[2]):null}var l=e('./utils'),t=e('./stash'),c=e('./libs/md5'),e={seperator:'###',limit:1,report_url:'https://statistics.pingxx.com/one_stats',timeout:100};e.store=function(e){if(!l.inWxLite()&&!l.inAlipayLite()&&'undefined'!=typeof localStorage&&null!==localStorage){var n={};n.app_id=e.app_id||t.app_id||'app_not_defined',n.ch_id=e.ch_id||'',n.channel=e.channel||'',n.type=e.type||'',n.user_agent='undefined'==typeof navigator?'':navigator.userAgent,n.host='undefined'==typeof window?'':window.location.host,n.time=(new Date).getTime(),n.puid=t.puid;var n='app_id='+n.app_id+'&channel='+n.channel+'&ch_id='+n.ch_id+'&host='+n.host+'&time='+n.time+'&type='+n.type+'&user_agent='+n.user_agent+'&puid='+n.puid,a=n;null!==localStorage.getItem('PPP_ONE_STATS')&&0!==localStorage.getItem('PPP_ONE_STATS').length&&(a=localStorage.getItem('PPP_ONE_STATS')+this.seperator+n);try{localStorage.setItem('PPP_ONE_STATS',a)}catch(e){}}},e.send=function(){if('undefined'!=typeof localStorage&&null!==localStorage){var e=localStorage.getItem('PPP_ONE_STATS');if(!(null===e||e.split(this.seperator).length<this.limit))try{for(var n=[],a=e.split(this.seperator),t=c(a.join('&')),r=0;r<a.length;r++)n.push({app_id:i(a[r],'app_id'),channel:i(a[r],'channel'),ch_id:i(a[r],'ch_id'),host:i(a[r],'host'),time:i(a[r],'time'),type:i(a[r],'type'),user_agent:i(a[r],'user_agent'),puid:i(a[r],'puid')});l.request(this.report_url,'POST',n,function(e,n){200==n&&localStorage.removeItem('PPP_ONE_STATS')},void 0,{'X-Pingpp-Report-Token':t})}catch(e){}}},e.report=function(e){var n;l.inWxLite()||l.inAlipayLite()||((n=this).store(e),setTimeout(function(){n.send()},n.timeout))},n.exports=e},{"./libs/md5":41,"./stash":45,"./utils":47}],39:[function(e,n,a){n.exports={Error:function(e,n){this.message=e,this.extra=n}}},{}],40:[function(e,n,a){var t=e('./stash'),r=e('./utils'),i=e('./collection');n.exports={SRC_URL:'https://cookie.pingxx.com',init:function(){var e=this;r.documentReady(function(){try{r.inWxLite()||r.inAlipayLite()||e.initPuid()}catch(e){}})},initPuid:function(){if('undefined'!=typeof window&&'undefined'!=typeof localStorage&&null!==localStorage){var n,e=localStorage.getItem('pingpp_uid');if(null===e){e=r.randomString();try{localStorage.setItem('pingpp_uid',e)}catch(e){}}if(t.puid=e,!document.getElementById('p_analyse_iframe')){try{n=document.createElement('iframe')}catch(e){n=document.createElement('<iframe name="ifr"></iframe>')}n.id='p_analyse_iframe',n.src=this.SRC_URL+'/?puid='+e,n.style.display='none',document.body.appendChild(n)}setTimeout(function(){i.send()},0)}}}},{"./collection":38,"./stash":45,"./utils":47}],41:[function(e,n,a){function d(e,n){var a=(65535&e)+(65535&n);return(e>>16)+(n>>16)+(a>>16)<<16|65535&a}function c(e,n,a,t,r,i){return d((i=d(d(n,e),d(t,i)))<<(r=r)|i>>>32-r,a)}function p(e,n,a,t,r,i,l){return c(n&a|~n&t,e,n,r,i,l)}function h(e,n,a,t,r,i,l){return c(n&t|a&~t,e,n,r,i,l)}function f(e,n,a,t,r,i,l){return c(n^a^t,e,n,r,i,l)}function _(e,n,a,t,r,i,l){return c(a^(n|~t),e,n,r,i,l)}function l(e,n){var a,t,r,i;e[n>>5]|=128<<n%32,e[14+(n+64>>>9<<4)]=n;for(var l=1732584193,c=-271733879,o=-1732584194,s=271733878,u=0;u<e.length;u+=16)l=p(a=l,t=c,r=o,i=s,e[u],7,-680876936),s=p(s,l,c,o,e[u+1],12,-389564586),o=p(o,s,l,c,e[u+2],17,606105819),c=p(c,o,s,l,e[u+3],22,-1044525330),l=p(l,c,o,s,e[u+4],7,-176418897),s=p(s,l,c,o,e[u+5],12,1200080426),o=p(o,s,l,c,e[u+6],17,-1473231341),c=p(c,o,s,l,e[u+7],22,-45705983),l=p(l,c,o,s,e[u+8],7,1770035416),s=p(s,l,c,o,e[u+9],12,-1958414417),o=p(o,s,l,c,e[u+10],17,-42063),c=p(c,o,s,l,e[u+11],22,-1990404162),l=p(l,c,o,s,e[u+12],7,1804603682),s=p(s,l,c,o,e[u+13],12,-40341101),o=p(o,s,l,c,e[u+14],17,-1502002290),l=h(l,c=p(c,o,s,l,e[u+15],22,1236535329),o,s,e[u+1],5,-165796510),s=h(s,l,c,o,e[u+6],9,-1069501632),o=h(o,s,l,c,e[u+11],14,643717713),c=h(c,o,s,l,e[u],20,-373897302),l=h(l,c,o,s,e[u+5],5,-701558691),s=h(s,l,c,o,e[u+10],9,38016083),o=h(o,s,l,c,e[u+15],14,-660478335),c=h(c,o,s,l,e[u+4],20,-405537848),l=h(l,c,o,s,e[u+9],5,568446438),s=h(s,l,c,o,e[u+14],9,-1019803690),o=h(o,s,l,c,e[u+3],14,-187363961),c=h(c,o,s,l,e[u+8],20,1163531501),l=h(l,c,o,s,e[u+13],5,-1444681467),s=h(s,l,c,o,e[u+2],9,-51403784),o=h(o,s,l,c,e[u+7],14,1735328473),l=f(l,c=h(c,o,s,l,e[u+12],20,-1926607734),o,s,e[u+5],4,-378558),s=f(s,l,c,o,e[u+8],11,-2022574463),o=f(o,s,l,c,e[u+11],16,1839030562),c=f(c,o,s,l,e[u+14],23,-35309556),l=f(l,c,o,s,e[u+1],4,-1530992060),s=f(s,l,c,o,e[u+4],11,1272893353),o=f(o,s,l,c,e[u+7],16,-155497632),c=f(c,o,s,l,e[u+10],23,-1094730640),l=f(l,c,o,s,e[u+13],4,681279174),s=f(s,l,c,o,e[u],11,-358537222),o=f(o,s,l,c,e[u+3],16,-722521979),c=f(c,o,s,l,e[u+6],23,76029189),l=f(l,c,o,s,e[u+9],4,-640364487),s=f(s,l,c,o,e[u+12],11,-421815835),o=f(o,s,l,c,e[u+15],16,530742520),l=_(l,c=f(c,o,s,l,e[u+2],23,-995338651),o,s,e[u],6,-198630844),s=_(s,l,c,o,e[u+7],10,1126891415),o=_(o,s,l,c,e[u+14],15,-1416354905),c=_(c,o,s,l,e[u+5],21,-57434055),l=_(l,c,o,s,e[u+12],6,1700485571),s=_(s,l,c,o,e[u+3],10,-1894986606),o=_(o,s,l,c,e[u+10],15,-1051523),c=_(c,o,s,l,e[u+1],21,-2054922799),l=_(l,c,o,s,e[u+8],6,1873313359),s=_(s,l,c,o,e[u+15],10,-30611744),o=_(o,s,l,c,e[u+6],15,-1560198380),c=_(c,o,s,l,e[u+13],21,1309151649),l=_(l,c,o,s,e[u+4],6,-145523070),s=_(s,l,c,o,e[u+11],10,-1120210379),o=_(o,s,l,c,e[u+2],15,718787259),c=_(c,o,s,l,e[u+9],21,-343485551),l=d(l,a),c=d(c,t),o=d(o,r),s=d(s,i);return[l,c,o,s]}function o(e){for(var n='',a=0;a<32*e.length;a+=8)n+=String.fromCharCode(e[a>>5]>>>a%32&255);return n}function s(e){var n,a=[];for(a[(e.length>>2)-1]=void 0,n=0;n<a.length;n+=1)a[n]=0;for(n=0;n<8*e.length;n+=8)a[n>>5]|=(255&e.charCodeAt(n/8))<<n%32;return a}function t(e){for(var n,a='0123456789abcdef',t='',r=0;r<e.length;r+=1)n=e.charCodeAt(r),t+=a.charAt(n>>>4&15)+a.charAt(15&n);return t}function r(e){return unescape(encodeURIComponent(e))}function i(e){return o(l(s(e=r(e)),8*e.length))}function u(e,n){return function(e,n){var a,t=s(e),r=[],i=[];for(r[15]=i[15]=void 0,16<t.length&&(t=l(t,8*e.length)),a=0;a<16;a+=1)r[a]=909522486^t[a],i[a]=1549556828^t[a];return n=l(r.concat(s(n)),512+8*n.length),o(l(i.concat(n),640))}(r(e),r(n))}n.exports=function(e,n,a){return n?a?u(n,e):t(u(n,e)):a?i(e):t(i(e))}},{}],42:[function(e,n,a){function PingppSDK(){e('./init').init()}var t=e('./version').v,i={}.hasOwnProperty;PingppSDK.prototype.version=t,n.exports=new PingppSDK;var l=e('./testmode'),c=e('./callbacks'),o=e('./errors').Error,s=e('./mods'),u=e('./stash'),d=e('./collection'),p=e('./payment_elements');PingppSDK.prototype.createPayment=function(e,n,a,t){'function'==typeof n&&(c.userCallback=n);try{p.init(e)}catch(e){if(e instanceof o)return void c.innerCallback('fail',c.error(e.message,e.extra));throw e}if(i.call(p,'id'))if(i.call(p,'channel')){i.call(p,'app')&&('string'==typeof p.app?u.app_id=p.app:'object'==typeof p.app&&'string'==typeof p.app.id&&(u.app_id=p.app.id)),d.report({type:u.type||'pure_sdk_click',channel:p.channel,ch_id:p.id});var r=p.channel;if(i.call(p,'credential'))if(p.paid&&0===p.actual_amount)c.innerCallback('success');else if(p.credential)if(i.call(p.credential,r))if(i.call(p,'livemode')){n=s.getChannelModule(r);if(void 0===n)return console.error('channel module "'+r+'" is undefined'),void c.innerCallback('fail',c.error('invalid_channel','channel module "'+r+'" is undefined'));!1!==p.livemode?(void 0!==a&&(u.signature=a),'boolean'==typeof t&&(u.debug=t),n.handleCharge(p)):(i.call(n,'runTestMode')?n:l).runTestMode(p)}else c.innerCallback('fail',c.error('invalid_charge','no_livemode_field'));else c.innerCallback('fail',c.error('invalid_credential','credential_is_incorrect'));else c.innerCallback('fail',c.error('invalid_credential','credential_is_undefined'));else c.innerCallback('fail',c.error('invalid_charge','no_credential'))}else c.innerCallback('fail',c.error('invalid_charge','no_channel'));else c.innerCallback('fail',c.error('invalid_charge','no_charge_id'))},PingppSDK.prototype.setAPURL=function(e){u.APURL=e},PingppSDK.prototype.setUrlReturnCallback=function(e,n){if('function'!=typeof e)throw'callback need to be a function';if(c.urlReturnCallback=e,void 0!==n){if(!Array.isArray(n))throw'channels need to be an array';c.urlReturnChannels=n}},PingppSDK.prototype.signAgreement=function(e,n){'function'==typeof n&&(c.userAgreementCallback=n);n=s.getExtraModule('agreement');return void 0===n?(console.error('module "agreement" is undefined'),c.innerCallback('fail',c.error('invalid_module','module "agreement" is undefined')),!1):n.signAgreement(e)}},{"./callbacks":2,"./collection":38,"./errors":39,"./init":40,"./mods":43,"./payment_elements":44,"./stash":45,"./testmode":46,"./version":48}],43:[function(e,n,a){var t={}.hasOwnProperty,r={};(n.exports=r).channels={alipay:e('./channels/alipay'),alipay_lite:e('./channels/alipay_lite'),alipay_pc_direct:e('./channels/alipay_pc_direct'),alipay_qr:e('./channels/alipay_qr'),alipay_qr_lakala:e('./channels/alipay_qr_lakala'),alipay_wap:e('./channels/alipay_wap'),alipay_wap_lakala:e('./channels/alipay_wap_lakala'),bfb_wap:e('./channels/bfb_wap'),cb_alipay_pc_direct:e('./channels/cb_alipay_pc_direct'),cb_alipay_wap:e('./channels/cb_alipay_wap'),cb_wx_pub:e('./channels/cb_wx_pub'),ccb_qr:e('./channels/ccb_qr'),ccb_wap:e('./channels/ccb_wap'),cmb_pc_qr:e('./channels/cmb_pc_qr'),cmb_wallet:e('./channels/cmb_wallet'),coolcredit:e('./channels/coolcredit'),cp_b2b:e('./channels/cp_b2b'),isv_lite:e('./channels/isv_lite'),isv_wap:e('./channels/isv_wap'),jdpay_wap:e('./channels/jdpay_wap'),pab_pc:e('./channels/pab_pc'),paypal:e('./channels/paypal'),qpay_pub:e('./channels/qpay_pub'),upacp_b2b:e('./channels/upacp_b2b'),upacp_pc:e('./channels/upacp_pc'),upacp_wap:e('./channels/upacp_wap'),wx_lite:e('./channels/wx_lite'),wx_lite_pab:e('./channels/wx_lite_pab'),wx_pub:e('./channels/wx_pub'),wx_pub_hzbank:e('./channels/wx_pub_hzbank'),wx_pub_pab:e('./channels/wx_pub_pab'),wx_wap:e('./channels/wx_wap'),yeepay_wap:e('./channels/yeepay_wap')},r.extras={ap:e('./channels/extras/ap'),agreement:e('./agreement')},r.getChannelModule=function(e){if(t.call(r.channels,e))return r.channels[e]},r.getExtraModule=function(e){if(t.call(r.extras,e))return r.extras[e]}},{"./agreement":1,"./channels/alipay":3,"./channels/alipay_lite":4,"./channels/alipay_pc_direct":5,"./channels/alipay_qr":6,"./channels/alipay_qr_lakala":7,"./channels/alipay_wap":8,"./channels/alipay_wap_lakala":9,"./channels/bfb_wap":10,"./channels/cb_alipay_pc_direct":11,"./channels/cb_alipay_wap":12,"./channels/cb_wx_pub":13,"./channels/ccb_qr":14,"./channels/ccb_wap":15,"./channels/cmb_pc_qr":16,"./channels/cmb_wallet":17,"./channels/coolcredit":19,"./channels/cp_b2b":20,"./channels/extras/ap":21,"./channels/isv_lite":22,"./channels/isv_wap":23,"./channels/jdpay_wap":24,"./channels/pab_pc":25,"./channels/paypal":26,"./channels/qpay_pub":27,"./channels/upacp_b2b":28,"./channels/upacp_pc":29,"./channels/upacp_wap":30,"./channels/wx_lite":31,"./channels/wx_lite_pab":32,"./channels/wx_pub":33,"./channels/wx_pub_hzbank":34,"./channels/wx_pub_pab":35,"./channels/wx_wap":36,"./channels/yeepay_wap":37}],44:[function(e,n,a){var i=e('./errors').Error,l={}.hasOwnProperty;n.exports={id:null,or_id:null,channel:null,app:null,credential:{},extra:null,livemode:null,order_no:null,time_expire:null,paid:!1,status:null,actual_amount:null,init:function(e){var n,a;if('string'==typeof e)try{n=JSON.parse(e)}catch(e){throw new i('json_decode_fail',e)}else n=e;if(void 0===n)throw new i('json_decode_fail');if(l.call(n,'object')&&'order'==n.object){n.or_id=n.id,n.order_no=n.merchant_order_no;var t=n.charge_essentials;if(n.channel=t.channel,n.credential=t.credential,n.extra=t.extra,l.call(n,'charge')&&null!=n.charge)n.id=n.charge;else if(l.call(t,'id')&&null!=t.id)n.id=t.id;else if(l.call(n,'charges'))for(var r=0;r<n.charges.data.length;r++)if(n.charges.data[r].channel===t.channel){n.id=n.charges.data[r].id;break}}else l.call(n,'object')&&'recharge'==n.object&&(n=n.charge);for(a in this)l.call(n,a)&&(this[a]=n[a]);return this},clear:function(){for(var e in this)'function'!=typeof this[e]&&(this[e]=null)}}},{"./errors":39}],45:[function(e,n,a){n.exports={}},{}],46:[function(e,n,a){var t=e('./utils'),r={}.hasOwnProperty;n.exports={PINGPP_MOCK_URL:'http://sissi.pingxx.com/mock.php',runTestMode:function(e){var n={ch_id:e.id,scheme:'http',channel:e.channel};r.call(e,'order_no')?n.order_no=e.order_no:r.call(e,'orderNo')&&(n.order_no=e.orderNo),r.call(e
,'time_expire')?n.time_expire=e.time_expire:r.call(e,'timeExpire')&&(n.time_expire=e.timeExpire),r.call(e,'extra')&&(n.extra=encodeURIComponent(JSON.stringify(e.extra))),t.redirectTo(this.PINGPP_MOCK_URL+'?'+t.stringifyData(n),e.channel)}}},{"./utils":47}],47:[function(e,n,a){var t=e('./callbacks'),o={}.hasOwnProperty,s=n.exports={stringifyData:function(e,n,a){void 0===a&&(a=!1);var t,r=[];for(t in e)o.call(e,t)&&'function'!=typeof e[t]&&('bfb_wap'==n&&'url'==t||'yeepay_wap'==n&&'mode'==t||'channel_url'!=t&&r.push(t+'='+(a?encodeURIComponent(e[t]):e[t])));return r.join('&')},request:function(e,n,a,t,r,i){if('undefined'!=typeof XMLHttpRequest){var l=new XMLHttpRequest;if(void 0!==l.timeout&&(l.timeout=6e3),'GET'===(n=n.toUpperCase())&&'object'==typeof a&&a&&(e+='?'+s.stringifyData(a,'',!0)),l.open(n,e,!0),void 0!==i)for(var c in i)o.call(i,c)&&l.setRequestHeader(c,i[c]);'POST'===n?(l.setRequestHeader('Content-type','application/json; charset=utf-8'),l.send(JSON.stringify(a))):l.send(),void 0===t&&(t=function(){}),void 0===r&&(r=function(){}),l.onreadystatechange=function(){4==l.readyState&&t(l.responseText,l.status,l)},l.onerror=function(e){r(l,0,e)}}else console.log('Function XMLHttpRequest is undefined.')},formSubmit:function(e,n,a){if('undefined'!=typeof window){var t,r,i=document.createElement('form');for(t in i.setAttribute('method',n),i.setAttribute('action',e),a)o.call(a,t)&&((r=document.createElement('input')).setAttribute('type','hidden'),r.setAttribute('name',t),r.setAttribute('value',a[t]),i.appendChild(r));document.body.appendChild(i),i.submit()}else console.log('Not a browser, form submit url: '+e)},randomString:function(e){void 0===e&&(e=32);for(var n='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789',a=n.length,t='',r=0;r<e;r++)t+=n.charAt(Math.floor(Math.random()*a));return t},redirectTo:function(e,n){t.shouldReturnUrlByCallback(n)?t.triggerUrlReturnCallback(null,e):'undefined'!=typeof window?window.top.location.href=e:console.log('Not a browser, redirect url: '+e)},inWeixin:function(){return'undefined'!=typeof navigator&&-1!==navigator.userAgent.toLowerCase().indexOf('micromessenger')},inAlipay:function(){return'undefined'!=typeof navigator&&-1!==navigator.userAgent.toLowerCase().indexOf('alipayclient')},inWxLite:function(){return'undefined'!=typeof wx&&(wx.miniProgram||wx.requestPayment)},inAlipayLite:function(){return'undefined'!=typeof my&&my.tradePay},documentReady:function(e){'undefined'==typeof document||'loading'!=document.readyState?e():document.addEventListener('DOMContentLoaded',e)},loadUrlJs:function(e,n,a){var t=document.getElementsByTagName('head')[0],r=null;null==document.getElementById(e)?((r=document.createElement('script')).setAttribute('type','text/javascript'),r.setAttribute('src',n),r.setAttribute('id',e),r.async=!0,null!=a&&(r.onload=r.onreadystatechange=function(){if(r.ready)return!1;r.readyState&&'loaded'!=r.readyState&&'complete'!=r.readyState||(r.ready=!0,a())}),t.appendChild(r)):null!=a&&a()}}},{"./callbacks":2}],48:[function(e,n,a){n.exports={v:'2.2.21'}},{}]},{},[42])(42)});
//# sourceMappingURL=pingpp.js.map
